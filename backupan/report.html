<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Bulanan - Tracking Amalan Harian</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ec4899">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <a href="dashboard.html" class="nav-brand">üìä Laporan</a>
            <div class="nav-menu">
                <button id="exportReport" class="btn btn-ghost btn-sm">
                    üì§ Export
                </button>
                <button id="logoutButton" class="btn btn-ghost btn-sm">
                    Keluar
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container main-content">
        <!-- Header Section -->
        <header class="report-header mb-4">
            <div class="card">
                <div class="card-header text-center">
                    <h1>üìä Laporan Bulanan</h1>
                    <p class="text-muted">Analisis dan perbandingan amalan harian</p>
                </div>
            </div>
        </header>

        <!-- Period Selector -->
        <section class="period-selector mb-4">
            <div class="card">
                <div class="card-header">
                    <h3>Pilih Periode</h3>
                </div>
                <div class="card-body">
                    <div class="period-controls">
                        <div class="form-group">
                            <label for="monthSelector">Bulan</label>
                            <select id="monthSelector" class="form-select">
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="yearSelector">Tahun</label>
                            <select id="yearSelector" class="form-select">
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <button id="loadReportButton" class="btn btn-primary">
                                üìä Muat Laporan
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Summary Statistics -->
        <section class="summary-section mb-4">
            <div class="card">
                <div class="card-header">
                    <h3>Ringkasan Statistik</h3>
                    <span id="reportPeriod" class="badge badge-primary">-</span>
                </div>
                <div class="card-body">
                    <div id="reportSummary" class="summary-grid">
                        <!-- Summary cards will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Member Comparison -->
        <section class="comparison-section mb-4">
            <div class="card">
                <div class="card-header">
                    <h3>Perbandingan Anggota</h3>
                    <div class="comparison-controls">
                        <button id="toggleChartType" class="btn btn-secondary btn-sm">
                            üìà Ubah Tampilan
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="memberComparison" class="comparison-content">
                        <!-- Member comparison will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Amalan Analysis -->
        <section class="amalan-analysis mb-4">
            <div class="card">
                <div class="card-header">
                    <h3>Analisis per Amalan</h3>
                </div>
                <div class="card-body">
                    <div id="amalanAnalysis" class="analysis-content">
                        <!-- Amalan analysis will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Weekly Trends -->
        <section class="trends-section mb-4">
            <div class="card">
                <div class="card-header">
                    <h3>Tren Mingguan</h3>
                </div>
                <div class="card-body">
                    <div id="weeklyTrends" class="trends-content">
                        <!-- Weekly trends will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Detailed Table -->
        <section class="detailed-table mb-4">
            <div class="card">
                <div class="card-header">
                    <h3>Tabel Detail</h3>
                    <div class="table-controls">
                        <button id="toggleTableView" class="btn btn-secondary btn-sm">
                            üîÑ Ubah View
                        </button>
                        <button id="sortTable" class="btn btn-ghost btn-sm">
                            ‚ÜïÔ∏è Urutkan
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="reportTable" class="table-container">
                        <!-- Detailed table will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Insights -->
        <section class="insights-section mb-4">
            <div class="card">
                <div class="card-header">
                    <h3>üí° Insight & Rekomendasi</h3>
                </div>
                <div class="card-body">
                    <div id="reportInsights" class="insights-content">
                        <!-- Insights will be generated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Navigation Footer -->
        <footer class="report-footer text-center mt-4">
            <div class="card">
                <div class="card-body">
                    <div class="footer-actions">
                        <button onclick="window.location.href='dashboard.html'" class="btn btn-secondary">
                            ‚Üê Kembali ke Dashboard
                        </button>
                        <button id="printReport" class="btn btn-outline">
                            üñ®Ô∏è Cetak Laporan
                        </button>
                        <button id="shareReport" class="btn btn-primary">
                            üì§ Bagikan Laporan
                        </button>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Memuat laporan...</p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>

    <script>
        // Report page specific functionality
        let currentChartType = 'bar';
        let currentTableView = 'member';
        let currentSortColumn = 'totalAmalan';
        let currentSortOrder = 'desc';

        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            if (!isLoggedIn()) {
                window.location.href = 'index.html';
                return;
            }

            // Setup report page functionality
            setupReportFeatures();

            console.log('Report page initialized');
        });

        function setupReportFeatures() {
            // Load report button
            const loadBtn = document.getElementById('loadReportButton');
            if (loadBtn) {
                loadBtn.addEventListener('click', loadReportData);
            }

            // Export button
            const exportBtn = document.getElementById('exportReport');
            if (exportBtn) {
                exportBtn.addEventListener('click', handleAdvancedExport);
            }

            // Chart type toggle
            const chartToggle = document.getElementById('toggleChartType');
            if (chartToggle) {
                chartToggle.addEventListener('click', toggleChartType);
            }

            // Table view toggle
            const tableToggle = document.getElementById('toggleTableView');
            if (tableToggle) {
                tableToggle.addEventListener('click', toggleTableView);
            }

            // Sort table
            const sortBtn = document.getElementById('sortTable');
            if (sortBtn) {
                sortBtn.addEventListener('click', sortTable);
            }

            // Print report
            const printBtn = document.getElementById('printReport');
            if (printBtn) {
                printBtn.addEventListener('click', printReport);
            }

            // Share report
            const shareBtn = document.getElementById('shareReport');
            if (shareBtn) {
                shareBtn.addEventListener('click', shareReport);
            }
        }

        function toggleChartType() {
            currentChartType = currentChartType === 'bar' ? 'pie' : 'bar';
            renderMemberComparison();
            
            const btn = document.getElementById('toggleChartType');
            btn.textContent = currentChartType === 'bar' ? 'ü•ß Pie Chart' : 'üìä Bar Chart';
        }

        function toggleTableView() {
            currentTableView = currentTableView === 'member' ? 'amalan' : 'member';
            renderDetailedTable();
            
            const btn = document.getElementById('toggleTableView');
            btn.textContent = currentTableView === 'member' ? 'üìù View per Amalan' : 'üë• View per Member';
        }

        function sortTable() {
            // Cycle through sort options
            const sortOptions = [
                { column: 'totalAmalan', order: 'desc', label: 'Total ‚Üì' },
                { column: 'totalAmalan', order: 'asc', label: 'Total ‚Üë' },
                { column: 'name', order: 'asc', label: 'Nama ‚Üë' },
                { column: 'name', order: 'desc', label: 'Nama ‚Üì' }
            ];
            
            const currentIndex = sortOptions.findIndex(opt => 
                opt.column === currentSortColumn && opt.order === currentSortOrder
            );
            
            const nextIndex = (currentIndex + 1) % sortOptions.length;
            const nextSort = sortOptions[nextIndex];
            
            currentSortColumn = nextSort.column;
            currentSortOrder = nextSort.order;
            
            renderDetailedTable();
            
            const btn = document.getElementById('sortTable');
            btn.textContent = `‚ÜïÔ∏è ${nextSort.label}`;
        }

        function handleAdvancedExport() {
            if (!AppState.reportData) {
                UIUtils.showToast('Tidak ada data untuk diekspor', 'error');
                return;
            }

            const month = DateUtils.getMonthName(AppState.currentMonth);
            const year = AppState.currentYear;
            
            // Create comprehensive CSV
            let csvContent = `Laporan Amalan Harian - ${month} ${year}\n\n`;
            
            // Summary section
            csvContent += `RINGKASAN STATISTIK\n`;
            csvContent += `Periode,${month} ${year}\n`;
            csvContent += `Total Amalan,${AppState.reportData.summary?.totalAmalan || 0}\n`;
            csvContent += `Anggota Teraktif,${AppState.reportData.summary?.mostActive || '-'}\n`;
            csvContent += `Rata-rata per Anggota,${AppState.reportData.summary?.avgPerMember || 0}\n\n`;
            
            // Member details
            csvContent += `DETAIL PER ANGGOTA\n`;
            csvContent += `Nama,Total Amalan,Amalan Terfavorit,Konsistensi\n`;
            
            const memberData = AppState.reportData.members || {};
            MEMBERS.forEach(member => {
                const data = memberData[member] || {};
                csvContent += `${member},${data.totalAmalan || 0},${data.topAmalan || '-'},${data.consistency || 0}%\n`;
            });
            
            csvContent += `\n`;
            
            // Amalan breakdown
            csvContent += `BREAKDOWN PER AMALAN\n`;
            csvContent += `Amalan,Total,ATK,AYS,FTR,WIN\n`;
            
            DEFAULT_AMALAN.forEach(amalan => {
                const amalanData = AppState.reportData.amalan?.[amalan] || {};
                csvContent += `${amalan},${amalanData.total || 0}`;
                
                MEMBERS.forEach(member => {
                    csvContent += `,${amalanData[member] || 0}`;
                });
                
                csvContent += `\n`;
            });
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `laporan-amalan-${month.toLowerCase()}-${year}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            UIUtils.showToast('Laporan detail berhasil diekspor', 'success');
        }

        function printReport() {
            window.print();
        }

        function shareReport() {
            if (!AppState.reportData) {
                UIUtils.showToast('Tidak ada data untuk dibagikan', 'error');
                return;
            }

            const month = DateUtils.getMonthName(AppState.currentMonth);
            const year = AppState.currentYear;
            const summary = AppState.reportData.summary || {};
            
            const shareText = `üìä Laporan Amalan ${month} ${year}

üìà Total Amalan: ${summary.totalAmalan || 0}
ü•á Teraktif: ${summary.mostActive || '-'}
üìä Rata-rata: ${summary.avgPerMember || 0}

Alhamdulillah, semoga berkah! ü§≤`;

            if (navigator.share) {
                navigator.share({
                    title: `Laporan Amalan ${month} ${year}`,
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    UIUtils.showToast('Laporan disalin ke clipboard', 'success');
                });
            }
        }

        // Override renderReport to include all sections
        const originalRenderReport = window.renderReport;
        window.renderReport = function() {
            if (originalRenderReport) {
                originalRenderReport();
            }
            
            // Update period display
            updatePeriodDisplay();
            
            // Render additional sections
            renderMemberComparison();
            renderAmalanAnalysis();
            renderWeeklyTrends();
            renderDetailedTable();
            renderInsights();
        };

        function updatePeriodDisplay() {
            const periodBadge = document.getElementById('reportPeriod');
            if (periodBadge) {
                const month = DateUtils.getMonthName(AppState.currentMonth);
                periodBadge.textContent = `${month} ${AppState.currentYear}`;
            }
        }

        function renderMemberComparison() {
            const container = document.getElementById('memberComparison');
            if (!container || !AppState.reportData) return;

            const memberData = AppState.reportData.members || {};
            
            if (currentChartType === 'bar') {
                renderBarChart(container, memberData);
            } else {
                renderPieChart(container, memberData);
            }
        }

        function renderBarChart(container, memberData) {
            let chartHTML = '<div class="bar-chart">';
            
            const maxValue = Math.max(...MEMBERS.map(member => memberData[member]?.totalAmalan || 0));
            
            MEMBERS.forEach(member => {
                const data = memberData[member] || {};
                const value = data.totalAmalan || 0;
                const percentage = maxValue > 0 ? (value / maxValue) * 100 : 0;
                
                chartHTML += `
                    <div class="bar-item">
                        <div class="bar-label">${member}</div>
                        <div class="bar-container">
                            <div class="bar-fill" style="width: ${percentage}%"></div>
                            <div class="bar-value">${value}</div>
                        </div>
                    </div>
                `;
            });
            
            chartHTML += '</div>';
            container.innerHTML = chartHTML;
        }

        function renderPieChart(container, memberData) {
            const total = MEMBERS.reduce((sum, member) => sum + (memberData[member]?.totalAmalan || 0), 0);
            
            if (total === 0) {
                container.innerHTML = '<p class="text-center text-muted">Tidak ada data untuk ditampilkan</p>';
                return;
            }
            
            let chartHTML = '<div class="pie-chart-container">';
            chartHTML += '<div class="pie-chart">';
            
            let startAngle = 0;
            const colors = ['#ec4899', '#be185d', '#f9a8d4', '#9d174d'];
            
            MEMBERS.forEach((member, index) => {
                const value = memberData[member]?.totalAmalan || 0;
                const percentage = (value / total) * 100;
                const angle = (value / total) * 360;
                
                const color = colors[index];
                
                // Create pie slice (simplified representation)
                chartHTML += `
                    <div class="pie-slice" style="
                        --start-angle: ${startAngle}deg;
                        --end-angle: ${startAngle + angle}deg;
                        --color: ${color};
                    "></div>
                `;
                
                startAngle += angle;
            });
            
            chartHTML += '</div>';
            
            // Legend
            chartHTML += '<div class="pie-legend">';
            MEMBERS.forEach((member, index) => {
                const value = memberData[member]?.totalAmalan || 0;
                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                
                chartHTML += `
                    <div class="legend-item">
                        <div class="legend-color" style="background: ${colors[index]}"></div>
                        <span class="legend-label">${member}: ${value} (${percentage}%)</span>
                    </div>
                `;
            });
            chartHTML += '</div>';
            
            chartHTML += '</div>';
            container.innerHTML = chartHTML;
        }

        function renderAmalanAnalysis() {
            const container = document.getElementById('amalanAnalysis');
            if (!container || !AppState.reportData) return;

            const amalanData = AppState.reportData.amalan || {};
            
            let analysisHTML = '<div class="amalan-grid">';
            
            // Sort amalan by total
            const sortedAmalan = DEFAULT_AMALAN
                .map(amalan => ({
                    name: amalan,
                    total: amalanData[amalan]?.total || 0
                }))
                .sort((a, b) => b.total - a.total);

            sortedAmalan.forEach((item, index) => {
                const rank = index + 1;
                const rankClass = rank <= 3 ? `rank-${rank}` : '';
                
                analysisHTML += `
                    <div class="amalan-card ${rankClass}">
                        <div class="amalan-rank">#${rank}</div>
                        <div class="amalan-name">${item.name}</div>
                        <div class="amalan-total">${FormatUtils.formatNumber(item.total)}</div>
                        <div class="amalan-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${sortedAmalan[0].total > 0 ? (item.total / sortedAmalan[0].total) * 100 : 0}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            analysisHTML += '</div>';
            container.innerHTML = analysisHTML;
        }

        function renderWeeklyTrends() {
            const container = document.getElementById('weeklyTrends');
            if (!container || !AppState.reportData) return;

            const weeklyData = AppState.reportData.weekly || {};
            
            let trendsHTML = '<div class="trends-chart">';
            
            for (let week = 1; week <= 4; week++) {
                const weekData = weeklyData[week] || {};
                const total = weekData.total || 0;
                
                trendsHTML += `
                    <div class="trend-week">
                        <div class="week-label">Pekan ${week}</div>
                        <div class="week-bar">
                            <div class="week-fill" style="height: ${weeklyData[1]?.total > 0 ? (total / weeklyData[1].total) * 100 : 0}%"></div>
                        </div>
                        <div class="week-value">${total}</div>
                    </div>
                `;
            }
            
            trendsHTML += '</div>';
            container.innerHTML = trendsHTML;
        }

        function renderDetailedTable() {
            const container = document.getElementById('reportTable');
            if (!container || !AppState.reportData) return;

            if (currentTableView === 'member') {
                renderMemberTable(container);
            } else {
                renderAmalanTable(container);
            }
        }

        function renderMemberTable(container) {
            const memberData = AppState.reportData.members || {};
            
            // Sort members
            const sortedMembers = MEMBERS.map(member => ({
                name: member,
                ...memberData[member]
            })).sort((a, b) => {
                if (currentSortColumn === 'name') {
                    return currentSortOrder === 'asc' ? 
                        a.name.localeCompare(b.name) : 
                        b.name.localeCompare(a.name);
                } else {
                    const aVal = a[currentSortColumn] || 0;
                    const bVal = b[currentSortColumn] || 0;
                    return currentSortOrder === 'asc' ? aVal - bVal : bVal - aVal;
                }
            });

            let tableHTML = `
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Anggota</th>
                            <th>Total Amalan</th>
                            <th>Amalan Terfavorit</th>
                            <th>Konsistensi</th>
                            <th>Peringkat</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedMembers.forEach((member, index) => {
                const rank = index + 1;
                const rankClass = rank <= 3 ? `rank-${rank}` : '';
                
                tableHTML += `
                    <tr class="${rankClass}">
                        <td class="member-cell">
                            <div class="member-info">
                                <span class="member-name">${member.name}</span>
                            </div>
                        </td>
                        <td class="number-cell">${FormatUtils.formatNumber(member.totalAmalan || 0)}</td>
                        <td class="amalan-cell">${member.topAmalan || '-'}</td>
                        <td class="percentage-cell">${member.consistency || 0}%</td>
                        <td class="rank-cell">
                            <span class="rank-badge rank-${rank}">#${rank}</span>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
        }

        function renderAmalanTable(container) {
            const amalanData = AppState.reportData.amalan || {};
            
            let tableHTML = `
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>Amalan</th>
                            <th>Total</th>
                            ${MEMBERS.map(member => `<th>${member}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
            `;

            DEFAULT_AMALAN.forEach(amalan => {
                const data = amalanData[amalan] || {};
                const total = data.total || 0;
                
                tableHTML += `
                    <tr>
                        <td class="amalan-cell">${amalan}</td>
                        <td class="number-cell">${FormatUtils.formatNumber(total)}</td>
                        ${MEMBERS.map(member => `<td class="number-cell">${data[member] || 0}</td>`).join('')}
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            container.innerHTML = tableHTML;
        }

        function renderInsights() {
            const container = document.getElementById('reportInsights');
            if (!container || !AppState.reportData) return;

            const summary = AppState.reportData.summary || {};
            const memberData = AppState.reportData.members || {};
            
            let insights = [];
            
            // Generate insights based on data
            if (summary.mostActive) {
                insights.push(`üèÜ ${summary.mostActive} adalah anggota teraktif bulan ini dengan ${memberData[summary.mostActive]?.totalAmalan || 0} total amalan.`);
            }
            
            if (summary.totalAmalan > 0) {
                const avgPerMember = Math.round(summary.totalAmalan / MEMBERS.length);
                insights.push(`üìä Rata-rata amalan per anggota adalah ${avgPerMember}.`);
            }
            
            // Find most popular amalan
            const amalanData = AppState.reportData.amalan || {};
            const mostPopular = Object.entries(amalanData)
                .sort(([,a], [,b]) => (b.total || 0) - (a.total || 0))[0];
                
            if (mostPopular) {
                insights.push(`‚≠ê Amalan paling populer adalah "${mostPopular[0]}" dengan total ${mostPopular[1].total || 0}.`);
            }
            
            // Consistency insights
            const consistentMembers = MEMBERS.filter(member => 
                (memberData[member]?.consistency || 0) >= 80
            );
            
            if (consistentMembers.length > 0) {
                insights.push(`‚úÖ Anggota dengan konsistensi tinggi (‚â•80%): ${consistentMembers.join(', ')}.`);
            }
            
            if (insights.length === 0) {
                insights.push('üìà Semangat untuk terus meningkatkan amalan!');
            }
            
            const insightsHTML = insights.map(insight => 
                `<div class="insight-item">${insight}</div>`
            ).join('');
            
            container.innerHTML = `<div class="insights-list">${insightsHTML}</div>`;
        }
    </script>

    <style>
        .period-controls {
            display: flex;
            gap: var(--spacing-md);
            align-items: end;
            flex-wrap: wrap;
        }

        .period-controls .form-group {
            flex: 1;
            min-width: 120px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }

        .comparison-controls {
            display: flex;
            gap: var(--spacing-sm);
        }

        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .bar-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .bar-label {
            width: 60px;
            font-weight: 600;
            color: var(--primary-pink);
        }

        .bar-container {
            flex: 1;
            position: relative;
            height: 40px;
            background: var(--dark-tertiary);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-pink), var(--accent-pink));
            transition: width var(--transition-normal);
        }

        .bar-value {
            position: absolute;
            right: var(--spacing-sm);
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .pie-chart-container {
            display: flex;
            gap: var(--spacing-xl);
            align-items: center;
            justify-content: center;
        }

        .pie-legend {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .amalan-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--spacing-md);
        }

        .amalan-card {
            background: var(--dark-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            text-align: center;
        }

        .amalan-card.rank-1 { border-color: #ffd700; }
        .amalan-card.rank-2 { border-color: #c0c0c0; }
        .amalan-card.rank-3 { border-color: #cd7f32; }

        .amalan-rank {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: var(--spacing-xs);
        }

        .amalan-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
            font-size: 0.9rem;
        }

        .amalan-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-pink);
            margin-bottom: var(--spacing-sm);
        }

        .trends-chart {
            display: flex;
            justify-content: space-around;
            align-items: end;
            height: 200px;
            padding: var(--spacing-md);
            background: var(--dark-primary);
            border-radius: var(--radius-md);
        }

        .trend-week {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .week-bar {
            width: 40px;
            height: 120px;
            background: var(--dark-tertiary);
            border-radius: var(--radius-sm);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: end;
        }

        .week-fill {
            width: 100%;
            background: linear-gradient(to top, var(--primary-pink), var(--accent-pink));
            transition: height var(--transition-normal);
        }

        .week-label, .week-value {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--dark-primary);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .report-table th,
        .report-table td {
            padding: var(--spacing-md);
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .report-table th {
            background: var(--dark-secondary);
            font-weight: 600;
            color: var(--text-primary);
        }

        .report-table tr.rank-1 { background: rgba(255, 215, 0, 0.1); }
        .report-table tr.rank-2 { background: rgba(192, 192, 192, 0.1); }
        .report-table tr.rank-3 { background: rgba(205, 127, 50, 0.1); }

        .number-cell {
            text-align: right;
            font-weight: 600;
            color: var(--primary-pink);
        }

        .rank-badge {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .rank-badge.rank-1 { background: #ffd700; color: #000; }
        .rank-badge.rank-2 { background: #c0c0c0; color: #000; }
        .rank-badge.rank-3 { background: #cd7f32; color: #fff; }

        .insights-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .insight-item {
            padding: var(--spacing-md);
            background: var(--dark-primary);
            border-left: 4px solid var(--primary-pink);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
        }

        .footer-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        .table-controls {
            display: flex;
            gap: var(--spacing-sm);
        }

        @media (max-width: 480px) {
            .period-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .comparison-controls,
            .table-controls {
                flex-direction: column;
            }

            .pie-chart-container {
                flex-direction: column;
            }

            .trends-chart {
                height: 150px;
                padding: var(--spacing-sm);
            }

            .week-bar {
                width: 30px;
                height: 80px;
            }

            .footer-actions {
                flex-direction: column;
            }

            .report-table {
                font-size: 0.8rem;
            }

            .report-table th,
            .report-table td {
                padding: var(--spacing-sm);
            }
        }

        @media print {
            .nav, .footer-actions, .period-selector {
                display: none;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ccc;
            }
            
            body {
                background: white;
                color: black;
            }
        }
    </style>
</body>
</html>