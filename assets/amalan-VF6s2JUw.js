import{H as W,g as i,c as y,I as v,M as d,D as w}from"./index-w4NFn9Xs.js";function R(){const n=new Date().getDate();return Math.ceil(n/7)}function I(){return new Date().getMonth()+1}function L(){return new Date().getFullYear()}function U(o){return["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][o-1]||""}function C(o,n,l){const u=(o-1)*7+1,s=Math.min(o*7,new Date(l,n,0).getDate());return{startDate:u,endDate:s}}const J=W("amalan",()=>{const o=i(R()),n=i(I()),l=i(L()),u=i({}),s=i({}),g=i({}),c=i(!1),m=y(()=>{const e=(o.value-1)*7+1,a=Math.min(o.value*7,new Date(l.value,n.value,0).getDate());return{startDate:e,endDate:a}}),p=y(()=>!u.value||!u.value.stats?{total:0,average:0,topMember:"-"}:{total:u.value.stats.totalAmalan||0,average:Math.round(u.value.stats.avgAmalan||0),topMember:u.value.stats.topMember||"-"});async function h(){try{c.value=!0,console.log("🔄 Loading dashboard data for:",{week:o.value,month:n.value,year:l.value});const e=await v.getDashboardStats(o.value,n.value,l.value);if(console.log("📊 Dashboard response:",e),e)u.value=e,console.log("✅ Dashboard data loaded successfully");else throw new Error("Empty response from getDashboardStats")}catch(e){throw console.error("💥 Dashboard data load error:",e),u.value={...Object.fromEntries(d.map(a=>[a,{totalAmalan:0,completedAmalan:0}])),stats:{totalAmalan:0,avgAmalan:0,topMember:"-"},recentActivity:[]},e}finally{c.value=!1}}async function D(e){try{if(c.value=!0,console.log("👤 Loading member data for:",e),!d.includes(e))throw new Error(`Invalid member: ${e}`);const a=await v.getWeeklyData(e,o.value,n.value,l.value);if(console.log("📋 Member response for",e,":",a),a)s.value[e]=a,console.log("✅ Member data loaded for",e);else throw new Error(`Empty response for member ${e}`)}catch(a){throw console.error("💥 Member data load error for",e,":",a),s.value[e]={member:e,week:o.value,month:n.value,year:l.value,amalan:{},lastUpdate:null},a}finally{c.value=!1}}async function M(e,a,t){try{if(console.log("💾 Updating amalan:",{member:e,amalanName:a,jumlah:t}),!d.includes(e))throw new Error(`Invalid member: ${e}`);if(!w.includes(a))throw new Error(`Invalid amalan: ${a}`);const r=parseInt(t)||0;if(r<0)throw new Error("Jumlah amalan tidak boleh negatif");const f=await v.updateAmalan(e,a,r,o.value,n.value,l.value);if(console.log("💾 Update response:",f),f)s.value[e]||(s.value[e]={amalan:{}}),s.value[e].amalan||(s.value[e].amalan={}),s.value[e].amalan[a]=r,s.value[e].lastUpdate=new Date().toISOString(),await h(),console.log("✅ Amalan updated successfully");else throw new Error("Empty response from updateAmalan")}catch(r){throw console.error("💥 Update amalan error:",r),r}}async function A(e,a){try{c.value=!0,console.log("📊 Loading monthly report for:",{month:e,year:a});const t=await v.getMonthlyReport(e||n.value,a||l.value);if(console.log("📈 Monthly report response:",t),t)return g.value=t,console.log("✅ Monthly report loaded successfully"),t;throw new Error("Empty response from getMonthlyReport")}catch(t){throw console.error("💥 Monthly report load error:",t),g.value={month:e||n.value,year:a||l.value,summary:{totalAmalan:0,mostActive:"-",avgPerMember:0},members:Object.fromEntries(d.map(r=>[r,{totalAmalan:0,topAmalan:"-",consistency:0}])),amalan:Object.fromEntries(w.map(r=>[r,{total:0,...Object.fromEntries(d.map(f=>[f,0]))}])),weekly:{}},t}finally{c.value=!1}}function b(e){e>=1&&e<=4?(o.value=e,console.log("📅 Week changed to:",e)):console.warn("Invalid week:",e)}function E(e){let a=o.value+e,t=n.value,r=l.value;a<1?(a=4,t--,t<1&&(t=12,r--)):a>4&&(a=1,t++,t>12&&(t=1,r++)),o.value=a,n.value=t,l.value=r,console.log("📅 Week navigation to:",{week:a,month:t,year:r})}async function k(){try{console.log("🔄 Starting data sync..."),u.value={},s.value={};const e=await v.syncData();if(e.success)return await h(),console.log("✅ Data sync completed successfully"),{success:!0,message:"Data berhasil disinkronisasi"};throw new Error(e.error||"Sync failed")}catch(e){throw console.error("💥 Sync error:",e),e}}function S(){console.log("🐛 Amalan Store Debug:"),console.log("Current Period:",{week:o.value,month:n.value,year:l.value}),console.log("Dashboard Data:",u.value),console.log("Member Data:",s.value),console.log("Monthly Report:",g.value),console.log("Is Loading:",c.value),console.log("Weekly Stats:",p.value)}return{currentWeek:o,currentMonth:n,currentYear:l,dashboardData:u,memberData:s,monthlyReportData:g,isLoading:c,weekRange:m,weeklyStats:p,loadDashboardData:h,loadMemberData:D,updateMemberAmalan:M,loadMonthlyReport:A,setCurrentWeek:b,changeWeek:E,syncData:k,debugState:S}});export{U as a,I as b,L as c,C as g,J as u};
