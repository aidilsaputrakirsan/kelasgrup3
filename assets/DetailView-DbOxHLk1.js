import{_ as W,r as C,c as b,A as R,C as P,d as c,m,e,f as $,t as d,i as F,v as z,D as H,F as Y,q as G,n as K,y as O,u as Z,a as J,E as Q,G as S,o as X,M as ee,l as te,s as A,h as V,g as se,B as ae}from"./index-PPGknJ7D.js";import{u as ne,g as oe,a as L}from"./amalan-C31yEo_J.js";const re={class:"glass rounded-xl p-3 sm:p-4 transition-all duration-200 hover:shadow-md"},le={class:"flex justify-between items-start mb-3 sm:mb-4"},ie={class:"flex-1 pr-3"},de={class:"font-medium text-charcoal-soft text-sm sm:text-base leading-tight"},ue={class:"text-xs text-charcoal-soft/60 mt-1"},me={class:"text-right"},ce={class:"text-lg sm:text-xl font-bold text-dusty-rose"},pe={key:0,class:"text-xs text-yellow-600 font-medium"},ve={class:"flex items-center gap-2 sm:gap-3"},xe=["disabled"],be={class:"flex-1"},ge={class:"mt-3 flex gap-1 sm:gap-2"},fe=["onClick"],he=["disabled"],ye={key:0,class:"w-3 h-3 border border-green-600 border-t-transparent rounded-full animate-spin mx-auto"},ke={key:1},we={key:0,class:"mt-3"},_e={class:"w-full h-1.5 sm:h-1 bg-moonstone rounded-full overflow-hidden"},$e={class:"text-xs text-charcoal-soft/60 text-center mt-1"},Se={__name:"AmalanItem",props:{name:{type:String,required:!0},value:{type:Number,default:0},savedValue:{type:Number,default:0},isSaving:{type:Boolean,default:!1}},emits:["update","save"],setup(j,{emit:h}){const r=j,g=h,a=C(r.value.toString()),f=b(()=>{const n=R[r.name];return n?n.dailyText:"-"}),u=b(()=>{const n=R[r.name];return n?n.weeklyTarget:0}),o=b(()=>{const n=parseInt(a.value)||0;return Math.max(0,Math.min(9999,n))}),x=b(()=>u.value===0?0:Math.min(o.value/u.value*100,100)),k=b(()=>{const n=x.value;return n>=100?"bg-gradient-to-r from-emerald-500 to-teal-500":n>=75?"bg-gradient-to-r from-indigo-500 to-purple-500":n>=50?"bg-gradient-to-r from-dusty-rose to-lavender-mist":n>=25?"bg-gradient-to-r from-yellow-400 to-orange-400":"bg-gradient-to-r from-gray-400 to-gray-500"}),y=b(()=>o.value!==r.savedValue),I=b(()=>{const n=u.value;return n>=100?[{label:"+10",value:10},{label:"+50",value:50},{label:"+100",value:100}]:n>=10?[{label:"+1",value:1},{label:"+3",value:3},{label:"+5",value:5}]:[{label:"+1",value:1},{label:"+2",value:2},{label:"+3",value:3}]});P(()=>r.value,n=>{parseInt(a.value)!==n&&(a.value=n.toString())});function B(n){const l=n.target.value;if(l===""){a.value="";return}const p=parseInt(l)||0,s=Math.max(0,Math.min(9999,p));a.value=s.toString(),g("update",r.name,s)}function D(){(a.value===""||isNaN(parseInt(a.value)))&&(a.value="0",g("update",r.name,0))}function T(){const n=Math.min(9999,o.value+1);a.value=n.toString(),g("update",r.name,n)}function w(){const n=Math.max(0,o.value-1);a.value=n.toString(),g("update",r.name,n)}function M(n){const l=Math.min(9999,o.value+n);a.value=l.toString(),g("update",r.name,l)}function E(){a.value=r.savedValue.toString(),g("update",r.name,r.savedValue)}function N(){confirm(`Reset ${r.name} ke nol?`)&&(a.value="0",g("update",r.name,0))}function q(){g("save",r.name)}return(n,l)=>(m(),c("div",re,[e("div",le,[e("div",ie,[e("h4",de,d(j.name),1),e("div",ue," Target: "+d(f.value),1)]),e("div",me,[e("div",ce,d(o.value),1),l[3]||(l[3]=e("div",{class:"text-xs text-charcoal-soft/60"},"kali",-1)),y.value?(m(),c("div",pe," (dari "+d(j.savedValue)+") ",1)):$("",!0)])]),e("div",ve,[e("button",{onClick:w,disabled:o.value<=0,class:"w-11 h-11 sm:w-10 sm:h-10 rounded-full bg-red-100 hover:bg-red-200 disabled:bg-moonstone text-red-600 disabled:text-charcoal-soft/40 border border-red-200 disabled:border-white/20 transition-colors flex items-center justify-center disabled:cursor-not-allowed"},l[4]||(l[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)]),8,xe),e("div",be,[F(e("input",{"onUpdate:modelValue":l[0]||(l[0]=p=>a.value=p),type:"number",inputmode:"numeric",pattern:"[0-9]*",min:"0",max:"9999",class:"w-full glass rounded-lg px-3 sm:px-4 py-3 text-center text-base sm:text-lg font-bold text-charcoal-soft border border-white/20 focus:border-dusty-rose focus:ring-2 focus:ring-dusty-rose/20 transition-all duration-200 min-h-[44px]",onInput:B,onBlur:D,onKeypress:l[1]||(l[1]=H(p=>p.target.blur(),["enter"])),onFocus:l[2]||(l[2]=p=>p.target.select())},null,544),[[z,a.value]])]),e("button",{onClick:T,class:"w-11 h-11 sm:w-10 sm:h-10 rounded-full bg-green-100 hover:bg-green-200 text-green-600 border border-green-200 transition-colors flex items-center justify-center"},l[5]||(l[5]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)]))]),e("div",ge,[(m(!0),c(Y,null,G(I.value,p=>(m(),c("button",{key:p.label,onClick:s=>M(p.value),class:"flex-1 px-2 py-2 bg-white/50 backdrop-blur-sm hover:bg-white/80 text-charcoal-soft border border-white/20 rounded-lg transition-colors text-xs font-medium min-h-[36px]"},d(p.label),9,fe))),128)),y.value?(m(),c("button",{key:0,onClick:q,disabled:r.isSaving,class:"flex-1 px-2 py-2 bg-gradient-to-r from-green-100 to-green-200 hover:from-green-200 hover:to-green-300 disabled:from-gray-200 disabled:to-gray-300 text-green-700 disabled:text-gray-500 rounded-lg transition-colors text-xs font-medium min-h-[36px] border border-green-200"},[r.isSaving?(m(),c("span",ye)):(m(),c("span",ke,"💾 Simpan"))],8,he)):$("",!0),y.value?(m(),c("button",{key:1,onClick:E,class:"flex-1 px-2 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-700 rounded-lg transition-colors text-xs font-medium min-h-[36px] border border-yellow-200"}," ↶ Batal ")):$("",!0),!y.value&&o.value>0?(m(),c("button",{key:2,onClick:N,class:"flex-1 px-2 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors text-xs font-medium min-h-[36px] border border-red-200"}," Reset ")):$("",!0)]),u.value>0?(m(),c("div",we,[e("div",_e,[e("div",{style:O({width:`${x.value}%`}),class:K([k.value,"h-full transition-all duration-300 rounded-full"])},null,6)]),e("div",$e,d(o.value)+"/"+d(u.value)+" pekan ini ("+d(Math.round(x.value))+"%) ",1)])):$("",!0)]))}},Ae=W(Se,[["__scopeId","data-v-cd4f2300"]]),Ce={class:"min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50"},Me={class:"bg-white/80 backdrop-blur-sm border-b border-white/20 sticky top-0 z-40 shadow-sm"},je={class:"max-w-lg mx-auto px-3 py-3 sm:px-4 sm:py-4"},Te={class:"flex items-center justify-between"},Ve={class:"flex items-center gap-3"},Ie={class:"w-9 h-9 bg-gradient-to-br from-pink-500 to-purple-600 rounded-xl flex items-center justify-center"},Be={class:"text-white font-bold text-sm"},De={class:"max-w-lg mx-auto p-3 sm:p-4 space-y-4 sm:space-y-5"},Ee={class:"bg-gradient-to-r from-pink-500 to-purple-600 rounded-2xl p-5 sm:p-6 text-white shadow-xl"},Ne={class:"flex items-center gap-4"},qe={class:"w-14 h-14 sm:w-16 sm:h-16 bg-white/20 rounded-full flex items-center justify-center text-white font-bold text-xl sm:text-2xl"},Re={class:"flex-1"},Le={class:"text-xl sm:text-2xl font-bold mb-1"},Pe={class:"text-pink-100 text-sm sm:text-base"},Ye={class:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 sm:p-5 border border-white/20 shadow-sm"},Ge={class:"flex justify-between items-center gap-3"},Ue={class:"text-center px-2"},We={class:"font-bold text-gray-800 text-sm sm:text-base"},Fe={class:"text-xs sm:text-sm text-gray-500"},ze={class:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 sm:p-5 border border-white/20 shadow-sm"},He={class:"grid grid-cols-3 gap-4"},Ke={class:"text-center"},Oe={class:"text-lg sm:text-xl font-bold text-pink-600"},Ze={class:"text-center"},Je={class:"text-lg sm:text-xl font-bold text-purple-600"},Qe={class:"text-center"},Xe={class:"text-lg sm:text-xl font-bold text-indigo-600"},et={class:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 sm:p-5 border border-white/20 shadow-sm"},tt={class:"flex justify-between items-center mb-4 sm:mb-5"},st={class:"space-y-3 sm:space-y-4"},at={class:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 sm:p-5 border border-white/20 shadow-sm"},nt={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},ot=["disabled"],rt={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},lt={key:1},it={class:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-4 sm:p-5 border border-indigo-200/50 shadow-sm"},dt={class:"text-center"},ut={key:0,class:"fixed inset-0 bg-white/50 backdrop-blur-sm flex items-center justify-center z-50"},pt={__name:"DetailView",setup(j){const h=Q(),r=te(),g=Z(),a=ne(),f=J(),u=C(h.params.member),o=C({}),x=C({}),k=C(!1),y=C({}),I=b(()=>{const s=oe(a.currentWeek,a.currentMonth,a.currentYear),t=L(a.currentMonth);return`${s.startDate}-${s.endDate} ${t} ${a.currentYear}`}),B=b(()=>`${L(a.currentMonth)} ${a.currentYear}`),D=b(()=>Object.values(o.value).reduce((s,t)=>s+(t||0),0)),T=b(()=>Object.values(o.value).filter(s=>s>0).length),w=b(()=>{for(const s of S){const t=o.value[s]||0,i=x.value[s]||0;if(t!==i)return!0}return!1});async function M(){try{await a.loadMemberData(u.value);const s=a.memberData[u.value];if(s&&s.amalan)o.value={...s.amalan},x.value={...s.amalan};else{const i={};S.forEach(v=>{i[v]=0}),o.value=i,x.value={...i}}const t={};S.forEach(i=>{t[i]=!1}),y.value=t}catch{f.showToast("Gagal memuat data anggota","error")}}function E(s,t){o.value[s]=parseInt(t)||0}async function N(s){try{y.value[s]=!0;const t=o.value[s]||0;await a.updateMemberAmalan(u.value,s,t),x.value[s]=t,f.showToast(`${s} berhasil disimpan`,"success")}catch{f.showToast(`Gagal menyimpan ${s}`,"error")}finally{y.value[s]=!1}}async function q(){try{k.value=!0;const s=[];for(const v of S){const _=o.value[v]||0,U=x.value[v]||0;_!==U&&s.push({name:v,value:_})}if(s.length===0){f.showToast("Tidak ada perubahan untuk disimpan","info");return}console.log(`💾 Saving ${s.length} changed amalan:`,s.map(v=>v.name));const t=s.map(async({name:v,value:_})=>(await a.updateMemberAmalan(u.value,v,_),{name:v,value:_}));(await Promise.all(t)).forEach(({name:v,value:_})=>{x.value[v]=_}),f.showToast(`✅ ${s.length} amalan berhasil disimpan`,"success")}catch(s){console.error("❌ Save all error:",s),f.showToast("Gagal menyimpan beberapa data","error")}finally{k.value=!1}}function n(){confirm("Yakin ingin membatalkan semua perubahan yang belum disimpan?")&&(o.value={...x.value},f.showToast("Perubahan dibatalkan","info"))}function l(){const s=w.value?"PERINGATAN: Ini akan menghapus SEMUA amalan termasuk yang sudah disimpan! Yakin ingin reset ke nol?":"Yakin ingin reset semua amalan ke nol?";confirm(s)&&(Object.keys(o.value).forEach(t=>{o.value[t]=0}),f.showToast("Reset ke nol, jangan lupa simpan jika diinginkan","warning"))}async function p(s){w.value&&!confirm("Ada perubahan yang belum disimpan. Lanjutkan?")||(a.changeWeek(s),await M())}return X(async()=>{if(!u.value||!ee.includes(u.value)){f.showToast("Anggota tidak valid","error"),r.push("/dashboard");return}h.query.week&&a.setCurrentWeek(parseInt(h.query.week)),h.query.month&&(a.currentMonth=parseInt(h.query.month)),h.query.year&&(a.currentYear=parseInt(h.query.year)),await M()}),P(()=>h.params.member,s=>{s!==u.value&&(u.value=s,M())}),window.addEventListener("beforeunload",s=>{w.value&&(s.preventDefault(),s.returnValue="Ada perubahan yang belum disimpan")}),(s,t)=>(m(),c("div",Ce,[e("header",Me,[e("div",je,[e("div",Te,[e("button",{onClick:t[0]||(t[0]=i=>s.$router.go(-1)),class:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-colors -ml-2"},t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),e("span",{class:"hidden sm:inline font-medium"},"Kembali",-1)])),e("div",Ve,[e("div",Ie,[e("span",Be,d(u.value),1)]),t[6]||(t[6]=e("div",{class:"hidden sm:block"},[e("h1",{class:"text-lg font-bold text-gray-800"},"Input Amalan")],-1))]),e("button",{onClick:t[1]||(t[1]=(...i)=>A(g).logout&&A(g).logout(...i)),class:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-colors -mr-2"},t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),e("span",{class:"hidden sm:inline font-medium"},"Keluar",-1)]))])])]),e("main",De,[e("div",Ee,[e("div",Ne,[e("div",qe,d(u.value),1),e("div",Re,[e("h2",Le,d(u.value),1),e("div",Pe,d(I.value),1)])])]),e("div",Ye,[t[10]||(t[10]=e("h3",{class:"font-bold text-gray-800 mb-4 flex items-center gap-2 text-sm sm:text-base"},[e("span",null,"📅"),V(" Navigasi Pekan ")],-1)),e("div",Ge,[e("button",{onClick:t[2]||(t[2]=i=>p(-1)),class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 text-blue-700 hover:from-blue-100 hover:to-blue-200 rounded-lg transition-colors flex-1 sm:flex-none min-h-[44px] justify-center"},t[8]||(t[8]=[e("svg",{class:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),e("span",{class:"text-xs sm:text-sm font-medium"},"Sebelumnya",-1)])),e("div",Ue,[e("div",We,"Pekan "+d(A(a).currentWeek),1),e("div",Fe,d(B.value),1)]),e("button",{onClick:t[3]||(t[3]=i=>p(1)),class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-emerald-50 to-emerald-100 border border-emerald-200 text-emerald-700 hover:from-emerald-100 hover:to-emerald-200 rounded-lg transition-colors flex-1 sm:flex-none min-h-[44px] justify-center"},t[9]||(t[9]=[e("span",{class:"text-xs sm:text-sm font-medium"},"Selanjutnya",-1),e("svg",{class:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))])]),e("div",ze,[t[14]||(t[14]=e("h3",{class:"font-bold text-gray-800 mb-3 flex items-center gap-2 text-sm sm:text-base"},[e("span",null,"⚡"),V(" Status Pekan Ini ")],-1)),e("div",He,[e("div",Ke,[e("div",Oe,d(T.value),1),t[11]||(t[11]=e("div",{class:"text-xs text-pink-500"},"tercatat",-1))]),e("div",Ze,[e("div",Je,d(A(S).length-T.value),1),t[12]||(t[12]=e("div",{class:"text-xs text-purple-500"},"belum",-1))]),e("div",Qe,[e("div",Xe,d(D.value),1),t[13]||(t[13]=e("div",{class:"text-xs text-indigo-500"},"total",-1))])])]),e("div",et,[e("div",tt,[t[16]||(t[16]=e("h3",{class:"font-bold text-gray-800 flex items-center gap-2 text-sm sm:text-base"},[e("span",null,"📝"),V(" Daftar Amalan ")],-1)),w.value?(m(),c("button",{key:0,onClick:n,class:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-yellow-50 to-yellow-100 border border-yellow-200 text-yellow-700 hover:from-yellow-100 hover:to-yellow-200 rounded-lg transition-colors text-xs sm:text-sm font-medium min-h-[36px]"},t[15]||(t[15]=[e("span",null,"↶",-1),e("span",{class:"hidden sm:inline"},"Batal Semua",-1),e("span",{class:"sm:hidden"},"Batal",-1)]))):$("",!0)]),e("div",st,[(m(!0),c(Y,null,G(A(S),(i,v)=>(m(),ae(Ae,{key:i,name:i,value:o.value[i]||0,"saved-value":x.value[i]||0,"is-saving":y.value[i]||!1,onUpdate:E,onSave:N},null,8,["name","value","saved-value","is-saving"]))),128))])]),e("div",at,[t[18]||(t[18]=e("h3",{class:"font-bold text-gray-800 mb-4 flex items-center gap-2 text-sm sm:text-base"},[e("span",null,"⚡"),V(" Aksi Cepat ")],-1)),e("div",nt,[e("button",{onClick:l,class:"flex items-center gap-2 justify-center px-4 py-3 bg-gradient-to-r from-red-50 to-red-100 border border-red-200 text-red-700 hover:from-red-100 hover:to-red-200 rounded-lg transition-colors min-h-[44px] font-medium"},t[17]||(t[17]=[e("span",null,"🗑️",-1),e("span",null,"Reset ke Nol",-1)])),e("button",{disabled:!w.value||k.value,onClick:q,class:"flex items-center gap-2 justify-center px-4 py-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-lg transition-colors min-h-[44px] font-medium"},[k.value?(m(),c("span",rt)):(m(),c("span",lt,"💾")),e("span",null,d(k.value?"Menyimpan...":"Simpan Semua"),1)],8,ot)])]),e("div",it,[e("div",dt,[t[20]||(t[20]=e("div",{class:"text-xl sm:text-2xl mb-2"},"📊",-1)),t[21]||(t[21]=e("p",{class:"text-sm sm:text-base text-gray-700 font-medium mb-3"}," Lihat laporan lengkap dan statistik ",-1)),e("button",{onClick:t[4]||(t[4]=i=>s.$router.push("/report")),class:"flex items-center gap-2 justify-center px-4 py-2 bg-white/50 backdrop-blur-sm border border-indigo-300 text-indigo-700 hover:bg-indigo-50 rounded-lg transition-colors min-h-[44px] font-medium"},t[19]||(t[19]=[e("span",null,"📈",-1),e("span",null,"Buka Laporan",-1)]))])])]),A(a).isLoading?(m(),c("div",ut,t[22]||(t[22]=[se('<div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 sm:p-8 text-center border border-white/20 shadow-xl mx-4"><div class="w-12 h-12 mx-auto bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center animate-bounce-soft mb-4"><span class="text-white text-xl">📿</span></div><div class="w-8 h-8 border-3 border-pink-200 border-t-pink-500 rounded-full animate-spin mx-auto mb-4"></div><p class="text-gray-700 font-medium text-sm sm:text-base">Memuat data amalan...</p></div>',1)]))):$("",!0)]))}};export{pt as default};
