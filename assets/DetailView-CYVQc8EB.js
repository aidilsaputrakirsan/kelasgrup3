import{z as W,g as C,c as g,A as P,a as m,o as u,d as e,b as w,t as d,l as U,B as F,C as G,F as Y,s as L,n as H,D as K,u as O,f as Z,E as J,G as $,i as Q,p as X,x as A,e as I,j as ee,y as te}from"./index-CdZRi0_c.js";import{u as se,g as ae,a as R}from"./amalan-BneWHByz.js";const ne={class:"glass rounded-xl p-3 sm:p-4 transition-all duration-200 hover:shadow-md"},oe={class:"flex justify-between items-start mb-3 sm:mb-4"},re={class:"flex-1 pr-3"},le={class:"font-medium text-charcoal-soft text-sm sm:text-base leading-tight"},ie={class:"text-xs text-charcoal-soft/60 mt-1"},de={class:"text-right"},ue={class:"text-lg sm:text-xl font-bold text-dusty-rose"},me={key:0,class:"text-xs text-yellow-600 font-medium"},ce={class:"flex items-center gap-2 sm:gap-3"},pe=["disabled"],ve={class:"flex-1"},xe={class:"mt-3 flex gap-1 sm:gap-2"},ge=["onClick"],be=["disabled"],he={key:0,class:"w-3 h-3 border border-green-600 border-t-transparent rounded-full animate-spin mx-auto"},fe={key:1},ye={key:0,class:"mt-3"},ke={class:"w-full h-1.5 sm:h-1 bg-moonstone rounded-full overflow-hidden"},we={class:"text-xs text-charcoal-soft/60 text-center mt-1"},_e={__name:"AmalanItem",props:{name:{type:String,required:!0},value:{type:Number,default:0},savedValue:{type:Number,default:0},isSaving:{type:Boolean,default:!1}},emits:["update","save"],setup(j,{emit:h}){const r=j,b=h,a=C(r.value.toString()),p={"Dzikir pagi/petang":{daily:"1x/hari",weekly:7},Tilawah:{daily:"1 juz/hari",weekly:7},"Shalat tepat waktu":{daily:"5x/hari",weekly:35},"Shalat malam":{daily:"3x/pekan",weekly:3},"Shalat Dhuha":{daily:"3x/pekan",weekly:3},"Puasa Sunnah":{daily:"3x/pekan",weekly:3},Istighfar:{daily:"100x/hari",weekly:700},Shalawat:{daily:"100x/hari",weekly:700},"Membaca Baqiyatush-shalihat":{daily:"10x/hari",weekly:70},"Infaq Harian":{daily:"1x/hari",weekly:7},"Doa kemenangan dakwah dan umat islam":{daily:"1x/hari",weekly:7}},l=g(()=>{const n=parseInt(a.value)||0;return Math.max(0,Math.min(9999,n))}),c=g(()=>{const n=p[r.name];return n?n.daily:"-"}),v=g(()=>{const n=p[r.name];return n?n.weekly:0}),f=g(()=>v.value===0?0:Math.min(l.value/v.value*100,100)),_=g(()=>{const n=f.value;return n>=100?"bg-gradient-to-r from-emerald-500 to-teal-500":n>=75?"bg-gradient-to-r from-indigo-500 to-purple-500":n>=50?"bg-gradient-to-r from-dusty-rose to-lavender-mist":n>=25?"bg-gradient-to-r from-yellow-400 to-orange-400":"bg-gradient-to-r from-gray-400 to-gray-500"}),S=g(()=>l.value!==r.savedValue),V=g(()=>{const n=p[r.name];if(!n)return[{label:"+1",value:1},{label:"+5",value:5}];const o=n.weekly;return o>=100?[{label:"+10",value:10},{label:"+50",value:50},{label:"+100",value:100}]:o>=10?[{label:"+1",value:1},{label:"+3",value:3},{label:"+5",value:5}]:[{label:"+1",value:1},{label:"+2",value:2},{label:"+3",value:3}]});P(()=>r.value,n=>{parseInt(a.value)!==n&&(a.value=n.toString())});function B(n){const o=n.target.value;if(o===""){a.value="";return}const s=parseInt(o)||0,t=Math.max(0,Math.min(9999,s));a.value=t.toString(),b("update",r.name,t)}function T(){(a.value===""||isNaN(parseInt(a.value)))&&(a.value="0",b("update",r.name,0))}function y(){const n=Math.min(9999,l.value+1);a.value=n.toString(),b("update",r.name,n)}function M(){const n=Math.max(0,l.value-1);a.value=n.toString(),b("update",r.name,n)}function D(n){const o=Math.min(9999,l.value+n);a.value=o.toString(),b("update",r.name,o)}function q(){a.value=r.savedValue.toString(),b("update",r.name,r.savedValue)}function E(){confirm(`Reset ${r.name} ke nol?`)&&(a.value="0",b("update",r.name,0))}function N(){b("save",r.name)}return(n,o)=>(u(),m("div",ne,[e("div",oe,[e("div",re,[e("h4",le,d(j.name),1),e("div",ie," Target: "+d(c.value),1)]),e("div",de,[e("div",ue,d(l.value),1),o[3]||(o[3]=e("div",{class:"text-xs text-charcoal-soft/60"},"kali",-1)),S.value?(u(),m("div",me," (dari "+d(j.savedValue)+") ",1)):w("",!0)])]),e("div",ce,[e("button",{onClick:M,disabled:l.value<=0,class:"w-11 h-11 sm:w-10 sm:h-10 rounded-full bg-red-100 hover:bg-red-200 disabled:bg-moonstone text-red-600 disabled:text-charcoal-soft/40 border border-red-200 disabled:border-white/20 transition-colors flex items-center justify-center disabled:cursor-not-allowed"},o[4]||(o[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)]),8,pe),e("div",ve,[U(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>a.value=s),type:"number",inputmode:"numeric",pattern:"[0-9]*",min:"0",max:"9999",class:"w-full glass rounded-lg px-3 sm:px-4 py-3 text-center text-base sm:text-lg font-bold text-charcoal-soft border border-white/20 focus:border-dusty-rose focus:ring-2 focus:ring-dusty-rose/20 transition-all duration-200 min-h-[44px]",onInput:B,onBlur:T,onKeypress:o[1]||(o[1]=G(s=>s.target.blur(),["enter"])),onFocus:o[2]||(o[2]=s=>s.target.select())},null,544),[[F,a.value]])]),e("button",{onClick:y,class:"w-11 h-11 sm:w-10 sm:h-10 rounded-full bg-green-100 hover:bg-green-200 text-green-600 border border-green-200 transition-colors flex items-center justify-center"},o[5]||(o[5]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)]))]),e("div",xe,[(u(!0),m(Y,null,L(V.value,s=>(u(),m("button",{key:s.label,onClick:t=>D(s.value),class:"flex-1 px-2 py-2 bg-white/50 backdrop-blur-sm hover:bg-white/80 text-charcoal-soft border border-white/20 rounded-lg transition-colors text-xs font-medium min-h-[36px]"},d(s.label),9,ge))),128)),S.value?(u(),m("button",{key:0,onClick:N,disabled:r.isSaving,class:"flex-1 px-2 py-2 bg-gradient-to-r from-green-100 to-green-200 hover:from-green-200 hover:to-green-300 disabled:from-gray-200 disabled:to-gray-300 text-green-700 disabled:text-gray-500 rounded-lg transition-colors text-xs font-medium min-h-[36px] border border-green-200"},[r.isSaving?(u(),m("span",he)):(u(),m("span",fe,"💾 Simpan"))],8,be)):w("",!0),S.value?(u(),m("button",{key:1,onClick:q,class:"flex-1 px-2 py-2 bg-yellow-100 hover:bg-yellow-200 text-yellow-700 rounded-lg transition-colors text-xs font-medium min-h-[36px] border border-yellow-200"}," ↶ Batal ")):w("",!0),!S.value&&l.value>0?(u(),m("button",{key:2,onClick:E,class:"flex-1 px-2 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors text-xs font-medium min-h-[36px] border border-red-200"}," Reset ")):w("",!0)]),v.value>0?(u(),m("div",ye,[e("div",ke,[e("div",{style:K({width:`${f.value}%`}),class:H([_.value,"h-full transition-all duration-300 rounded-full"])},null,6)]),e("div",we,d(l.value)+"/"+d(v.value)+" pekan ini ("+d(Math.round(f.value))+"%) ",1)])):w("",!0)]))}},Se=W(_e,[["__scopeId","data-v-0d77375b"]]),$e={class:"min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50"},Ae={class:"bg-white/80 backdrop-blur-sm border-b border-white/20 sticky top-0 z-40 shadow-sm"},Ce={class:"max-w-lg mx-auto px-3 py-3 sm:px-4 sm:py-4"},Me={class:"flex items-center justify-between"},je={class:"flex items-center gap-3"},Te={class:"w-9 h-9 bg-gradient-to-br from-pink-500 to-purple-600 rounded-xl flex items-center justify-center"},Ie={class:"text-white font-bold text-sm"},Ve={class:"max-w-lg mx-auto p-3 sm:p-4 space-y-4 sm:space-y-5"},Be={class:"bg-gradient-to-r from-pink-500 to-purple-600 rounded-2xl p-5 sm:p-6 text-white shadow-xl"},De={class:"flex items-center gap-4"},qe={class:"w-14 h-14 sm:w-16 sm:h-16 bg-white/20 rounded-full flex items-center justify-center text-white font-bold text-xl sm:text-2xl"},Ee={class:"flex-1"},Ne={class:"text-xl sm:text-2xl font-bold mb-1"},Re={class:"text-pink-100 text-sm sm:text-base"},Pe={class:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 sm:p-5 border border-white/20 shadow-sm"},Ye={class:"flex justify-between items-center gap-3"},Le={class:"text-center px-2"},ze={class:"font-bold text-gray-800 text-sm sm:text-base"},We={class:"text-xs sm:text-sm text-gray-500"},Ue={class:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 sm:p-5 border border-white/20 shadow-sm"},Fe={class:"grid grid-cols-3 gap-4"},Ge={class:"text-center"},He={class:"text-lg sm:text-xl font-bold text-pink-600"},Ke={class:"text-center"},Oe={class:"text-lg sm:text-xl font-bold text-purple-600"},Ze={class:"text-center"},Je={class:"text-lg sm:text-xl font-bold text-indigo-600"},Qe={class:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 sm:p-5 border border-white/20 shadow-sm"},Xe={class:"flex justify-between items-center mb-4 sm:mb-5"},et={class:"space-y-3 sm:space-y-4"},tt={class:"bg-white/60 backdrop-blur-sm rounded-2xl p-4 sm:p-5 border border-white/20 shadow-sm"},st={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},at=["disabled"],nt={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},ot={key:1},rt={class:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-4 sm:p-5 border border-indigo-200/50 shadow-sm"},lt={class:"text-center"},it={key:0,class:"fixed inset-0 bg-white/50 backdrop-blur-sm flex items-center justify-center z-50"},mt={__name:"DetailView",setup(j){const h=J(),r=X(),b=O(),a=se(),p=Z(),l=C(h.params.member),c=C({}),v=C({}),f=C(!1),_=C({}),S=g(()=>{const s=ae(a.currentWeek,a.currentMonth,a.currentYear),t=R(a.currentMonth);return`${s.startDate}-${s.endDate} ${t} ${a.currentYear}`}),V=g(()=>`${R(a.currentMonth)} ${a.currentYear}`),B=g(()=>Object.values(c.value).reduce((s,t)=>s+(t||0),0)),T=g(()=>Object.values(c.value).filter(s=>s>0).length),y=g(()=>{for(const s of $){const t=c.value[s]||0,i=v.value[s]||0;if(t!==i)return!0}return!1});async function M(){try{await a.loadMemberData(l.value);const s=a.memberData[l.value];if(s&&s.amalan)c.value={...s.amalan},v.value={...s.amalan};else{const i={};$.forEach(x=>{i[x]=0}),c.value=i,v.value={...i}}const t={};$.forEach(i=>{t[i]=!1}),_.value=t}catch{p.showToast("Gagal memuat data anggota","error")}}function D(s,t){c.value[s]=parseInt(t)||0}async function q(s){try{_.value[s]=!0;const t=c.value[s]||0;await a.updateMemberAmalan(l.value,s,t),v.value[s]=t,p.showToast(`${s} berhasil disimpan`,"success")}catch{p.showToast(`Gagal menyimpan ${s}`,"error")}finally{_.value[s]=!1}}async function E(){try{f.value=!0;const s=[];for(const x of $){const k=c.value[x]||0,z=v.value[x]||0;k!==z&&s.push({name:x,value:k})}if(s.length===0){p.showToast("Tidak ada perubahan untuk disimpan","info");return}console.log(`💾 Saving ${s.length} changed amalan:`,s.map(x=>x.name));const t=s.map(async({name:x,value:k})=>(await a.updateMemberAmalan(l.value,x,k),{name:x,value:k}));(await Promise.all(t)).forEach(({name:x,value:k})=>{v.value[x]=k}),p.showToast(`✅ ${s.length} amalan berhasil disimpan`,"success")}catch(s){console.error("❌ Save all error:",s),p.showToast("Gagal menyimpan beberapa data","error")}finally{f.value=!1}}function N(){confirm("Yakin ingin membatalkan semua perubahan yang belum disimpan?")&&(c.value={...v.value},p.showToast("Perubahan dibatalkan","info"))}function n(){const s=y.value?"PERINGATAN: Ini akan menghapus SEMUA amalan termasuk yang sudah disimpan! Yakin ingin reset ke nol?":"Yakin ingin reset semua amalan ke nol?";confirm(s)&&(Object.keys(c.value).forEach(t=>{c.value[t]=0}),p.showToast("Reset ke nol, jangan lupa simpan jika diinginkan","warning"))}async function o(s){y.value&&!confirm("Ada perubahan yang belum disimpan. Lanjutkan?")||(a.changeWeek(s),await M())}return Q(async()=>{if(!l.value||!["ATK","AYS","FTR","WIN"].includes(l.value)){p.showToast("Anggota tidak valid","error"),r.push("/dashboard");return}h.query.week&&a.setCurrentWeek(parseInt(h.query.week)),h.query.month&&(a.currentMonth=parseInt(h.query.month)),h.query.year&&(a.currentYear=parseInt(h.query.year)),await M()}),P(()=>h.params.member,s=>{s!==l.value&&(l.value=s,M())}),window.addEventListener("beforeunload",s=>{y.value&&(s.preventDefault(),s.returnValue="Ada perubahan yang belum disimpan")}),(s,t)=>(u(),m("div",$e,[e("header",Ae,[e("div",Ce,[e("div",Me,[e("button",{onClick:t[0]||(t[0]=i=>s.$router.go(-1)),class:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-colors -ml-2"},t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),e("span",{class:"hidden sm:inline font-medium"},"Kembali",-1)])),e("div",je,[e("div",Te,[e("span",Ie,d(l.value),1)]),t[6]||(t[6]=e("div",{class:"hidden sm:block"},[e("h1",{class:"text-lg font-bold text-gray-800"},"Input Amalan")],-1))]),e("button",{onClick:t[1]||(t[1]=(...i)=>A(b).logout&&A(b).logout(...i)),class:"flex items-center gap-2 px-3 py-2 text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-colors -mr-2"},t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),e("span",{class:"hidden sm:inline font-medium"},"Keluar",-1)]))])])]),e("main",Ve,[e("div",Be,[e("div",De,[e("div",qe,d(l.value),1),e("div",Ee,[e("h2",Ne,d(l.value),1),e("div",Re,d(S.value),1)])])]),e("div",Pe,[t[10]||(t[10]=e("h3",{class:"font-bold text-gray-800 mb-4 flex items-center gap-2 text-sm sm:text-base"},[e("span",null,"📅"),I(" Navigasi Pekan ")],-1)),e("div",Ye,[e("button",{onClick:t[2]||(t[2]=i=>o(-1)),class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 text-blue-700 hover:from-blue-100 hover:to-blue-200 rounded-lg transition-colors flex-1 sm:flex-none min-h-[44px] justify-center"},t[8]||(t[8]=[e("svg",{class:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),e("span",{class:"text-xs sm:text-sm font-medium"},"Sebelumnya",-1)])),e("div",Le,[e("div",ze,"Pekan "+d(A(a).currentWeek),1),e("div",We,d(V.value),1)]),e("button",{onClick:t[3]||(t[3]=i=>o(1)),class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-emerald-50 to-emerald-100 border border-emerald-200 text-emerald-700 hover:from-emerald-100 hover:to-emerald-200 rounded-lg transition-colors flex-1 sm:flex-none min-h-[44px] justify-center"},t[9]||(t[9]=[e("span",{class:"text-xs sm:text-sm font-medium"},"Selanjutnya",-1),e("svg",{class:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]))])]),e("div",Ue,[t[14]||(t[14]=e("h3",{class:"font-bold text-gray-800 mb-3 flex items-center gap-2 text-sm sm:text-base"},[e("span",null,"⚡"),I(" Status Pekan Ini ")],-1)),e("div",Fe,[e("div",Ge,[e("div",He,d(T.value),1),t[11]||(t[11]=e("div",{class:"text-xs text-pink-500"},"tercatat",-1))]),e("div",Ke,[e("div",Oe,d(A($).length-T.value),1),t[12]||(t[12]=e("div",{class:"text-xs text-purple-500"},"belum",-1))]),e("div",Ze,[e("div",Je,d(B.value),1),t[13]||(t[13]=e("div",{class:"text-xs text-indigo-500"},"total",-1))])])]),e("div",Qe,[e("div",Xe,[t[16]||(t[16]=e("h3",{class:"font-bold text-gray-800 flex items-center gap-2 text-sm sm:text-base"},[e("span",null,"📝"),I(" Daftar Amalan ")],-1)),y.value?(u(),m("button",{key:0,onClick:N,class:"flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-yellow-50 to-yellow-100 border border-yellow-200 text-yellow-700 hover:from-yellow-100 hover:to-yellow-200 rounded-lg transition-colors text-xs sm:text-sm font-medium min-h-[36px]"},t[15]||(t[15]=[e("span",null,"↶",-1),e("span",{class:"hidden sm:inline"},"Batal Semua",-1),e("span",{class:"sm:hidden"},"Batal",-1)]))):w("",!0)]),e("div",et,[(u(!0),m(Y,null,L(A($),(i,x)=>(u(),te(Se,{key:i,name:i,value:c.value[i]||0,"saved-value":v.value[i]||0,"is-saving":_.value[i]||!1,onUpdate:D,onSave:q},null,8,["name","value","saved-value","is-saving"]))),128))])]),e("div",tt,[t[18]||(t[18]=e("h3",{class:"font-bold text-gray-800 mb-4 flex items-center gap-2 text-sm sm:text-base"},[e("span",null,"⚡"),I(" Aksi Cepat ")],-1)),e("div",st,[e("button",{onClick:n,class:"flex items-center gap-2 justify-center px-4 py-3 bg-gradient-to-r from-red-50 to-red-100 border border-red-200 text-red-700 hover:from-red-100 hover:to-red-200 rounded-lg transition-colors min-h-[44px] font-medium"},t[17]||(t[17]=[e("span",null,"🗑️",-1),e("span",null,"Reset ke Nol",-1)])),e("button",{disabled:!y.value||f.value,onClick:E,class:"flex items-center gap-2 justify-center px-4 py-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-lg transition-colors min-h-[44px] font-medium"},[f.value?(u(),m("span",nt)):(u(),m("span",ot,"💾")),e("span",null,d(f.value?"Menyimpan...":"Simpan Semua"),1)],8,at)])]),e("div",rt,[e("div",lt,[t[20]||(t[20]=e("div",{class:"text-xl sm:text-2xl mb-2"},"📊",-1)),t[21]||(t[21]=e("p",{class:"text-sm sm:text-base text-gray-700 font-medium mb-3"}," Lihat laporan lengkap dan statistik ",-1)),e("button",{onClick:t[4]||(t[4]=i=>s.$router.push("/report")),class:"flex items-center gap-2 justify-center px-4 py-2 bg-white/50 backdrop-blur-sm border border-indigo-300 text-indigo-700 hover:bg-indigo-50 rounded-lg transition-colors min-h-[44px] font-medium"},t[19]||(t[19]=[e("span",null,"📈",-1),e("span",null,"Buka Laporan",-1)]))])])]),A(a).isLoading?(u(),m("div",it,t[22]||(t[22]=[ee('<div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 sm:p-8 text-center border border-white/20 shadow-xl mx-4"><div class="w-12 h-12 mx-auto bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center animate-bounce-soft mb-4"><span class="text-white text-xl">📿</span></div><div class="w-8 h-8 border-3 border-pink-200 border-t-pink-500 rounded-full animate-spin mx-auto mb-4"></div><p class="text-gray-700 font-medium text-sm sm:text-base">Memuat data amalan...</p></div>',1)]))):w("",!0)]))}};export{mt as default};
