import{L as H,r as v,c as D,N as g,M as f,G as p,H as d}from"./index-DWCfbFiX.js";function N(){const n=new Date().getDate();return Math.ceil(n/7)}function _(){return new Date().getMonth()+1}function F(){return new Date().getFullYear()}function U(t){return["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][t-1]||""}function Y(t,n,r){const u=(t-1)*7+1,l=Math.min(t*7,new Date(r,n,0).getDate());return{startDate:u,endDate:l}}const C=H("amalan",()=>{const t=v(N()),n=v(_()),r=v(F()),u=v({}),l=v({}),h=v({}),c=v(!1),M=D(()=>{const a=(t.value-1)*7+1,e=Math.min(t.value*7,new Date(r.value,n.value,0).getDate());return{startDate:a,endDate:e}}),y=D(()=>!u.value||!u.value.stats?{total:0,average:0,topMember:"-"}:{total:u.value.stats.totalAmalan||0,average:Math.round(u.value.stats.avgAmalan||0),topMember:u.value.stats.topMember||"-"});async function m(){try{c.value=!0,console.log("üîÑ Loading dashboard data for:",{week:t.value,month:n.value,year:r.value});const a=await g.getDashboardStats(t.value,n.value,r.value);if(console.log("üìä Dashboard response:",a),a)u.value=a,console.log("‚úÖ Dashboard data loaded successfully");else throw new Error("Empty response from getDashboardStats")}catch(a){throw console.error("üí• Dashboard data load error:",a),u.value={...Object.fromEntries(f.map(e=>[e,{totalAmalan:0,completedAmalan:0,hariHalangan:0}])),stats:{totalAmalan:0,avgAmalan:0,topMember:"-"},recentActivity:[]},a}finally{c.value=!1}}async function E(a){try{if(c.value=!0,console.log("üë§ Loading member data for:",a),!f.includes(a))throw new Error(`Invalid member: ${a}`);const e=await g.getWeeklyData(a,t.value,n.value,r.value);if(console.log("üìã Member response for",a,":",e),e)l.value[a]=e,console.log("‚úÖ Member data loaded for",a);else throw new Error(`Empty response for member ${a}`)}catch(e){throw console.error("üí• Member data load error for",a,":",e),l.value[a]={member:a,week:t.value,month:n.value,year:r.value,amalan:{},hariHalangan:0,lastUpdate:null},e}finally{c.value=!1}}async function b(a,e,o){try{if(console.log("üíæ Updating amalan:",{member:a,amalanName:e,jumlah:o}),!f.includes(a))throw new Error(`Invalid member: ${a}`);const s=[...p,d.FIELD_NAME];if(!s.includes(e))throw console.error("‚ùå Invalid amalan name:",e),console.error("Valid amalan names:",s),new Error(`Invalid amalan: ${e}`);const i=parseInt(o)||0;if(e===d.FIELD_NAME){if(i<0||i>d.MAX_DAYS)throw new Error(`Hari Halangan harus antara 0-${d.MAX_DAYS} hari`)}else if(i<0)throw new Error("Jumlah amalan tidak boleh negatif");const A=await g.updateAmalan(a,e,i,t.value,n.value,r.value);if(console.log("üíæ Update response:",A),A)l.value[a]||(l.value[a]={amalan:{},hariHalangan:0}),e===d.FIELD_NAME?l.value[a].hariHalangan=i:(l.value[a].amalan||(l.value[a].amalan={}),l.value[a].amalan[e]=i),l.value[a].lastUpdate=new Date().toISOString(),await m(),console.log("‚úÖ Amalan updated successfully");else throw new Error("Empty response from updateAmalan")}catch(s){throw console.error("üí• Update amalan error:",s),s}}async function S(a,e){try{c.value=!0,console.log("üìä Loading monthly report for:",{month:a,year:e});const o=await g.getMonthlyReport(a||n.value,e||r.value);if(console.log("üìà Monthly report response:",o),o)return h.value=o,console.log("‚úÖ Monthly report loaded successfully"),o;throw new Error("Empty response from getMonthlyReport")}catch(o){throw console.error("üí• Monthly report load error:",o),h.value={month:a||n.value,year:e||r.value,summary:{totalAmalan:0,mostActive:"-",avgPerMember:0},members:Object.fromEntries(f.map(s=>[s,{totalAmalan:0,topAmalan:"-",consistency:0}])),amalan:Object.fromEntries(p.map(s=>[s,{total:0,...Object.fromEntries(f.map(i=>[i,0]))}])),weekly:{}},o}finally{c.value=!1}}function k(a){a>=1&&a<=4?(t.value=a,console.log("üìÖ Week changed to:",a)):console.warn("Invalid week:",a)}function I(a){let e=t.value+a,o=n.value,s=r.value;e<1?(e=4,o--,o<1&&(o=12,s--)):e>4&&(e=1,o++,o>12&&(o=1,s++)),t.value=e,n.value=o,r.value=s,console.log("üìÖ Week navigation to:",{week:e,month:o,year:s})}async function L(){try{console.log("üîÑ Starting data sync..."),u.value={},l.value={};const a=await g.syncData();if(a.success)return await m(),console.log("‚úÖ Data sync completed successfully"),{success:!0,message:"Data berhasil disinkronisasi"};throw new Error(a.error||"Sync failed")}catch(a){throw console.error("üí• Sync error:",a),a}}function R(a){return[...p,d.FIELD_NAME].includes(a)}function w(){return[...p,d.FIELD_NAME]}function W(){console.log("üêõ Amalan Store Debug:"),console.log("Current Period:",{week:t.value,month:n.value,year:r.value}),console.log("Dashboard Data:",u.value),console.log("Member Data:",l.value),console.log("Monthly Report:",h.value),console.log("Is Loading:",c.value),console.log("Weekly Stats:",y.value),console.log("Valid Amalan Names:",w())}return{currentWeek:t,currentMonth:n,currentYear:r,dashboardData:u,memberData:l,monthlyReportData:h,isLoading:c,weekRange:M,weeklyStats:y,loadDashboardData:m,loadMemberData:E,updateMemberAmalan:b,loadMonthlyReport:S,setCurrentWeek:k,changeWeek:I,syncData:L,debugState:W,isValidAmalanName:R,getValidAmalanNames:w}});export{U as a,_ as b,F as c,Y as g,C as u};
